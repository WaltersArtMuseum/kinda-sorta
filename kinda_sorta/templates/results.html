
<!DOCTYPE html>
<html>
	<head>
		<title>beastie</title>

	  	<link rel="stylesheet" href="//code.jquery.com/ui/1.10.4/themes/smoothness/jquery-ui.css">
		<link type="text/css" rel="stylesheet" href="{{ STATIC_URL }}/javascript/jquery.dropdown.css" />
		<link rel="stylesheet" href="{{ STATIC_URL }}style.css">
		
		<script src="//code.jquery.com/jquery-1.10.2.js"></script>
		<script src="//code.jquery.com/ui/1.10.4/jquery-ui.js"></script>
		<script type="text/javascript" src="{{ STATIC_URL }}/javascript/jquery.dropdown.js"></script>
		<script>
			// Slider jQuery
			// Taken from 
			// http://stackoverflow.com/questions/20091481/auto-resizing-the-select-element-according-to-selected-options-width
			$(document).ready(function() {
				$('select option').each(function() {
			    	$(this).data('original-text', $(this).text()); 
				});

				/*
				This event is the primary driver of the site. On change triggers a new query and display of results
				*/
				$('select').change(function (e) {
			    	$(this).find('option').each(function() {
			        	$(this).text($(this).data('original-text')); 
					});			    
			    	// var selText = $('select option:selected').text();
			    	// var selText = this.options[e.target.selectedIndex].text;
			    	// console.log(selText);
			    	$("#width_tmp").html(this.options[e.target.selectedIndex].text);
    				$(this).width($("#width_tmp").width()); 

    				/*
					Successfully logging the current values of all of the selects 
					Need to write those to a JSON object and pass back to VIEW (via AJAX below) to 
					construct and run a Solr query 
    				*/
    				
    				// Store current vales in this JSON object. This will be passed back to view.query()
    				var ks = {};
    				$('select').each(function() {
				   		var ksName = this.name;
				   		var e = document.getElementsByName(ksName);
				   		var val = e[0][e[0].options.selectedIndex].text;
				   		ks[ksName] = val;
			   		})

    				/*
					After changing one of the attributes; the Solr index should be requeried 
					using the new values 
    				*/
    				
    				$.ajax({
    					// TODO :: all of this needs to be written
	            		type: "POST",
	            		url: "../query/",
	            		// if not returning json from VIEW.query then this must be commented out
	            		// dataType: 'json',
	            		data: {
	            			'csrfmiddlewaretoken': '{{ csrf_token }}', 
	            			'ks': JSON.stringify(ks),
	            			// pass in values from selects
	            		}, 
	            		success: function(newData){
	            			// Write HTML
	    				    $("div#results").html(newData);
	    				},
	    				error: function(badData){
	    					console.log(badData)
						    alert('something has kinda-sorta gone wrong');
						}
	            	})
			 	});
			});
	  	</script>
	</head>

	<body>
		{% load humanize %}
		<div style="padding: 60px 30px">
			<div style="border: 2px solid; padding: 10px; overflow: auto">
				{% csrf_token %}
				<div style="float: left">
					<img src="{{ baseObj.img }}" height="300" style="padding-right: 15px">
				</div>
				{% include 'text_blob.html' %}
			</div>
			<!-- Page divider -->
			<div style="clear:both; margin: 30px 0px 30px"/>

			<div id='results'>
				{% include 'object_results.html' %}
			</div>
		</div>
	</body>
</html>
